---
phase: 01-specification
plan: 02
type: execute
---

<objective>
Document Steps 4-5 (Analyze Params, Validate Trades, Fix EA) - the LLM-assisted validation phase.

Purpose: Create complete specifications for the steps involving LLM parameter analysis and trade validation.
Output: 3 spec files (steps 4, 5, 5b) in `.planning/phases/01-specification/specs/`
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-specification/01-CONTEXT.md
@.planning/phases/01-specification/01-01-SUMMARY.md

**Source files to analyze:**
@engine/runner.py (continue_with_params, _step_validate_trades, _step_fix_ea)
@engine/gates.py (check_min_trades)
@modules/backtest.py (validation backtest)
@settings.py (MIN_TRADES, validation thresholds)

**Skill contracts:**
@.claude/skills/param-analyzer/SKILL.md (Step 4 LLM integration)
@.claude/skills/mql5-fixer/SKILL.md (Step 5B LLM integration)

**Reference:**
@CLAUDE.md (Step 4 output contract)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Document Step 4 (Analyze Params)</name>
  <files>.planning/phases/01-specification/specs/step-04-analyze-params.md</files>
  <action>This is the first LLM integration point. Document thoroughly:

  **From runner.py:**
  - Read `continue_with_params()` method
  - Document the two required artifacts: `wide_validation_params` and `optimization_ranges`
  - Document how safety params are automatically handled (forced loose for validation, fixed for optimization)
  - Document the `Use_*/Enable_*` toggle carry-forward behavior

  **From /param-analyzer skill:**
  - Read the skill definition
  - Document expected input format (params from Step 3)
  - Document expected output format (both artifacts)

  **Pause point:**
  - Document workflow pause state (`awaiting_param_analysis`)
  - Document resume mechanism (`continue_with_params()`)

  This spec is critical for Phase 7 (compatibility shim) - skills must continue working.</action>
  <verify>Spec includes: param input format, wide_validation_params format, optimization_ranges format, resume mechanism</verify>
  <done>Step 4 fully documented with LLM contract</done>
</task>

<task type="auto">
  <name>Task 2: Document Step 5 (Validate Trades)</name>
  <files>.planning/phases/01-specification/specs/step-05-validate-trades.md</files>
  <action>Document the trade validation step:

  **From runner.py:**
  - Read `_step_validate_trades()` method
  - Document how wide_validation_params are used
  - Document the validation backtest process

  **From modules/backtest.py:**
  - Read backtest execution logic
  - Document report parsing for trade count

  **From gates.py and settings.py:**
  - Read `check_min_trades()` gate
  - Document MIN_TRADES threshold (default value, configuration)
  - Document gate pass/fail conditions

  **Safety parameter handling:**
  - Document how injected safety params are loosened for validation
  - Explain why (avoid false "no trades" from tight safety limits)

  Include the exact data flow: wide params → backtest → trade count → gate check</action>
  <verify>Spec includes: MIN_TRADES threshold, backtest parameters, gate conditions</verify>
  <done>Step 5 fully documented</done>
</task>

<task type="auto">
  <name>Task 3: Document Step 5B (Fix EA)</name>
  <files>.planning/phases/01-specification/specs/step-05b-fix-ea.md</files>
  <action>Document the EA fix loop:

  **From runner.py:**
  - Read EA fix tracking (`ea_fix_attempts`, `max_ea_fix_attempts`)
  - Document the retry mechanism
  - Document when this step triggers (Step 5 fails with 0 trades)

  **From /mql5-fixer skill:**
  - Read the skill definition
  - Document what information is provided to the LLM
  - Document expected fix output

  **Loop behavior:**
  - Document max retry count (default: 3)
  - Document what happens after max retries (workflow fails)
  - Document restart_with_improved_ea() method

  **Gate:**
  - Same as Step 5: MIN_TRADES threshold
  - Document that gate is re-checked after each fix attempt</action>
  <verify>Spec includes: retry mechanism, max attempts, restart flow, skill contract</verify>
  <done>Step 5B fully documented</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All 3 spec files exist
- [ ] LLM skill contracts are completely documented
- [ ] Pause/resume mechanism documented for Step 4
- [ ] Retry mechanism documented for Step 5B
- [ ] All thresholds reference settings.py
</verification>

<success_criteria>

- Steps 4, 5, 5B fully documented
- /param-analyzer contract captured (input format, output format)
- /mql5-fixer contract captured (trigger conditions, expected behavior)
- Data flow clear: Step 3 params → LLM → wide params + ranges → validation
  </success_criteria>

<output>
After completion, create `.planning/phases/01-specification/01-02-SUMMARY.md`:

---
phase: 01-specification
plan: 02
subsystem: specification
requires: [step-3-spec]
provides: [step-4-spec, step-5-spec, step-5b-spec]
affects: [01-03, 02-core-domain, 07-compatibility-shim]
key-decisions: []
key-files: [.planning/phases/01-specification/specs/step-04-analyze-params.md, .planning/phases/01-specification/specs/step-05-validate-trades.md]
---

# Phase 01-specification Plan 02: Validation Steps Summary

**[One-liner summary]**

## Accomplishments

- [Key outcomes]

## Files Created/Modified

- [List of spec files]

## Decisions Made

[Or "None"]

## Issues Encountered

[Or "None"]

## Next Step

Ready for 01-03-PLAN.md (Steps 6-8 optimization)
</output>
