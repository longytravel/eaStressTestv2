---
phase: 01-specification
plan: 03
type: execute
---

<objective>
Document Steps 6-8 (Create INI, Run Optimization, Parse Results, Select Passes) - the optimization phase.

Purpose: Create complete specifications for the MT5 optimization steps and result selection.
Output: 4 spec files (steps 6, 7, 8, 8b) in `.planning/phases/01-specification/specs/`
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-specification/01-CONTEXT.md
@.planning/phases/01-specification/01-02-SUMMARY.md

**Source files to analyze:**
@engine/runner.py (steps 6, 7, 8, 8b implementations)
@engine/gates.py (optimization gates)
@modules/optimizer.py (optimization execution)
@modules/pass_analyzer.py (result parsing)
@settings.py (optimization settings, timeouts)

**Skill contracts:**
@.claude/skills/stats-analyzer/SKILL.md (Step 8B LLM integration)

**Reference:**
@CLAUDE.md (Step 8B selection contract)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Document Steps 6, 7 (Create INI, Run Optimization)</name>
  <files>.planning/phases/01-specification/specs/step-06-create-ini.md, .planning/phases/01-specification/specs/step-07-run-optimization.md</files>
  <action>Document the INI creation and optimization execution:

  **Step 6 (Create INI):**
  - Read `_step_create_ini()` in runner.py
  - Document INI file format for MT5 optimization
  - Document how optimization_ranges are converted to INI format
  - Document the Boolean bug (True/False vs 1/0) - this is a known issue
  - Document how `Use_*/Enable_*` toggles are carried forward as fixed params
  - Document safety param handling (fixed to safe values)

  **Step 7 (Run Optimization):**
  - Read `_step_run_optimization()` in runner.py
  - Read modules/optimizer.py for execution details
  - Document MT5 terminal invocation
  - Document timeout handling (OPTIMIZATION_TIMEOUT from settings)
  - Document genetic optimization parameters
  - Document progress logging ("still running" messages)
  - Document output location (XML report)</action>
  <verify>INI format documented, timeout handling documented, known Boolean bug flagged</verify>
  <done>Steps 6, 7 fully documented</done>
</task>

<task type="auto">
  <name>Task 2: Document Step 8 (Parse Results)</name>
  <files>.planning/phases/01-specification/specs/step-08-parse-results.md</files>
  <action>Document the optimization result parsing:

  **From runner.py:**
  - Read `_step_parse_results()` method
  - Document what gets parsed from optimization XML
  - Document filtering (MIN_TRADES threshold)

  **From modules/pass_analyzer.py:**
  - Read parsing logic
  - Document pass data structure (all fields extracted)
  - Document how passes are scored

  **Gate:**
  - Document "passes > 0" gate condition
  - Document what happens when all passes filtered out

  **Output format:**
  - Document the exact data structure returned
  - Document where full results are stored
  - Document what gets passed to Step 8B for selection</action>
  <verify>Spec includes: XML parsing, pass data structure, filtering logic</verify>
  <done>Step 8 fully documented</done>
</task>

<task type="auto">
  <name>Task 3: Document Step 8B (Select Passes)</name>
  <files>.planning/phases/01-specification/specs/step-08b-select-passes.md</files>
  <action>This is the second major LLM integration point. Document thoroughly:

  **From runner.py:**
  - Read `continue_with_selected_passes()` method
  - Read `_auto_select_passes()` method
  - Document the `awaiting_stats_analysis` pause state
  - Document `auto_stats_analysis` flag behavior

  **Auto-selection:**
  - Document composite score calculation
  - Document the scoring weights
  - Document the "positive back+forward" bonus

  **LLM selection (/stats-analyzer skill):**
  - Read the skill definition
  - Document input format (optimization results)
  - Document output format (selected pass indices)

  **Re-optimization:**
  - Document `run_reopt_analysis()` method
  - Document reopt flow (called before Step 9)
  - Document what happens if user wants to re-optimize

  This spec is critical for understanding the full optimization loop.</action>
  <verify>Spec includes: auto-selection formula, LLM contract, reopt mechanism</verify>
  <done>Step 8B fully documented with both auto and LLM paths</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All 4 spec files exist
- [ ] INI format fully documented with known Boolean bug flagged
- [ ] Optimization timeout and settings documented
- [ ] Pass data structure completely specified
- [ ] Both auto-selection and LLM selection paths documented
- [ ] Re-optimization flow documented
</verification>

<success_criteria>

- Steps 6, 7, 8, 8B fully documented
- Boolean INI bug clearly flagged for later fixing
- /stats-analyzer contract captured
- Auto-selection scoring formula documented
- Re-optimization loop documented
  </success_criteria>

<output>
After completion, create `.planning/phases/01-specification/01-03-SUMMARY.md`:

---
phase: 01-specification
plan: 03
subsystem: specification
requires: [step-4-spec, step-5-spec]
provides: [step-6-spec, step-7-spec, step-8-spec, step-8b-spec]
affects: [01-04, 02-core-domain, 07-compatibility-shim]
key-decisions: []
key-files: [.planning/phases/01-specification/specs/step-06-create-ini.md, .planning/phases/01-specification/specs/step-08b-select-passes.md]
---

# Phase 01-specification Plan 03: Optimization Steps Summary

**[One-liner summary]**

## Accomplishments

- [Key outcomes]

## Files Created/Modified

- [List of spec files]

## Decisions Made

[Or "None"]

## Issues Encountered

[Or "None"]

## Next Step

Ready for 01-04-PLAN.md (Steps 9-11 analysis)
</output>
