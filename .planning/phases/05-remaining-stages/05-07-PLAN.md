---
phase: 05-remaining-stages
plan: 07
type: execute
---

<objective>
Implement MultiPairStage (Step 14) - optional multi-symbol testing.

Purpose: Run the workflow on additional trading symbols.
Output: `ea_stress/stages/s14_multi_pair.py`
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior summaries:
@.planning/phases/04-stage-framework/04-01-SUMMARY.md
@.planning/phases/05-remaining-stages/05-06-SUMMARY.md

# Specifications:
@.planning/phases/01-specification/specs/step-14-multi-pair.md

# Existing patterns:
@ea_stress/stages/base.py
@ea_stress/stages/s05_validate_trades.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement MultiPairStage class</name>
  <files>ea_stress/stages/s14_multi_pair.py</files>
  <action>
Create MultiPairStage following the Stage protocol.

This stage runs full workflows on additional symbols:
1. Read settings.MULTI_PAIR_SYMBOLS (default: ["EURUSD", "USDJPY"])
2. Filter out parent symbol
3. Skip if no additional symbols or missing params
4. For each symbol:
   - Create child workflow (cannot instantiate WorkflowRunner from stage)
   - Return metadata for pipeline to orchestrate

Key from spec (step-14-multi-pair.md):
- Each symbol runs FULL optimization (not just backtest)
- Uses parent's wide_validation_params and optimization_ranges
- Children have auto_run_multi_pair=False (prevent recursion)
- Very expensive: 3-13 hours per additional symbol
- Default: AUTO_RUN_MULTI_PAIR = False

Gate: None (informational/optional step).

Note: This stage CANNOT directly create child WorkflowRunner instances.
It returns the configuration needed for the Pipeline/Runner to orchestrate.

Return StageResult with:
- skipped: True if no additional symbols
- symbols: List of symbols to test
- parent_params: wide_validation_params and optimization_ranges
- runs: Empty list (populated by pipeline after execution)

The actual child workflow creation is the responsibility of the
Pipeline/Runner in Phase 6, not this stage.
  </action>
  <verify>python -c "from ea_stress.stages.s14_multi_pair import MultiPairStage; print(MultiPairStage().name)"</verify>
  <done>MultiPairStage class exists with name '14_multi_pair'</done>
</task>

<task type="auto">
  <name>Task 2: Export stage from package</name>
  <files>ea_stress/stages/__init__.py</files>
  <action>
Add MultiPairStage to lazy imports.

Update _stage_modules dict:
  "MultiPairStage": "s14_multi_pair"

Add to __all__ list.
  </action>
  <verify>python -c "from ea_stress.stages import MultiPairStage"</verify>
  <done>MultiPairStage importable from ea_stress.stages</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python -c "from ea_stress.stages import MultiPairStage"` succeeds
- [ ] `python -m pytest -q` passes all existing tests
- [ ] MultiPairStage.name returns "14_multi_pair"
- [ ] All 14 stage classes now exported from ea_stress.stages
</verification>

<success_criteria>

- MultiPairStage prepares multi-symbol config
- Stage returns metadata for pipeline orchestration
- Stage is skippable (optional)
- All 14 stages complete (1, 1B, 1C, 2, 3, 4, 5, 5B, 6, 7, 8, 8B, 9, 10, 11, 12, 13, 14)
- All existing tests pass
- Phase 5 complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-remaining-stages/05-07-SUMMARY.md`
</output>
